<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>ZXing Multi Barcode Decoder</title>
		<link rel="stylesheet" href="https://unpkg.com/milligram@1.3.0/dist/milligram.min.css" />
	</head>

	<body>
		<main class="wrapper" style="padding-top:2em">
			<section class="container" id="demo-content">
				<div>
					<input type="file" id="fileInput" accept="image/*" />
					<a class="button" id="decodeButton">Decode</a>
				</div>
				<div>
					<img id="img" src="" style="max-width:100%; border:1px solid gray; margin-top:1em" />
				</div>
				<label>Result:</label>
				<pre><code id="result"></code></pre>
			</section>
		</main>

		<script src="https://unpkg.com/@zxing/library@latest"></script>
		<script>
			window.addEventListener('load', function () {
				const codeReader = new ZXing.BrowserMultiFormatReader();
				const fileInput = document.getElementById('fileInput');
				const decodeButton = document.getElementById('decodeButton');
				const imgElement = document.getElementById('img');
				const resultElement = document.getElementById('result');

				fileInput.addEventListener('change', () => {
					const file = fileInput.files[0];
					if (file) {
						const reader = new FileReader();
						reader.onload = e => {
							imgElement.src = e.target.result;
						};
						reader.readAsDataURL(file);
					}
				});

				decodeButton.addEventListener('click', () => {
					resultElement.textContent = 'Decoding...';
					codeReader.decodeFromImage(imgElement)
						.then(result => {
							console.log(result);
							resultElement.textContent = `Text: ${result.text}\nFormat: ${result.format}`
						})
						.catch(err => {
							console.error(err);
							resultElement.textContent = 'Error: ' + err;
						});
				});
			});
		</script>
	</body>

</html>